import unittest
from unittest.mock import patch
from handlers import ListingsHandler

"""
RENTAL RESP
{'comparableRentals': 1, 'percentile_25': 1999, 'highRent': 1999, 'lowRent': 1999, 'lat': 40.638317,
 'median': 1999, 'rent': 1999, 'percentile_75': 1999, 'long': -73.594849}

agentActiveListings
{'listings': [{'bathrooms': 2, 'home_marketing_type': 'forSale', 'has_vr_model': False, 'primary_photo_url': 'https://photos.zillowstatic.com/fp/b75e350b0c1fdec0ae559f8900f11ca0-a_a.jpg', 'longitude': -73.72697, 'hasOpenHouse': False, 'address': {'line1': '22 Park Pl 
APT 4F', 'stateOrProvince': 'NY', 'line2': 'Great Neck, NY 11021', 'postalCode': '11021', 'city': 'Great Neck'}, 
'home_marketing_status': 'active', 'latitude': 40.78996, 'bedrooms': 2, 'openHouses': '', 'zpid': 2057575583,
 'brokerage_name': 'Douglas Elliman Real Estate', 'listing_url': '/homedetails/22-Park-Pl-APT-4F-Great-Neck-NY-11021/2057575583_zpid/', 
 'price_currency': 'usd', 'price': 798000, 'home_type': 'condo', 'status': 'fsba'}], 'current_page': 1, 'listing_count': 1}

 priceAndTaxHistory
 CRITICAL:root:priceAndTaxHistory response: {'priceHistory': [{'priceChangeRate': 0, 'date': '2023-07-09', 'source': 'OneKey® MLS', 'postingIsRental': False, 'time': 1688860800000, 'sellerAgent': None, 'showCountyLink': False, 'attributeSource': {'infoString2': 'OneKey® MLS', 'infoString3': 'https://photos.zillowstatic.com/fp/4e66a55bd37a412d002fb678e0dbded9-zillow_web_logo_inf_11.jpg', 'infoString1': '3450884'}, 'pricePerSquareFoot': 288, 'buyerAgent': None, 'event': 'Listed for sale', 'price': 370000}, {'priceChangeRate': 0, 'date': '2023-06-25', 'source': 'OneKey® MLS', 'postingIsRental': False, 'time': 1687651200000, 'sellerAgent': None, 'showCountyLink': False, 'attributeSource': {'infoString2': 'OneKey® MLS', 'infoString3': 'https://photos.zillowstatic.com/fp/4e66a55bd37a412d002fb678e0dbded9-zillow_web_logo_inf_11.jpg', 'infoString1': '3450884'}, 'pricePerSquareFoot': None, 'buyerAgent': None, 'event': 'Listing removed', 'price': None}, {'priceChangeRate': -0.13752913752914, 'date': '2023-02-11', 'source': 'OneKey® MLS', 'postingIsRental': False, 'time': 1676073600000, 'sellerAgent': None, 'showCountyLink': False, 'attributeSource': {'infoString2': 'OneKey® MLS', 'infoString3': 'https://photos.zillowstatic.com/fp/4e66a55bd37a412d002fb678e0dbded9-zillow_web_logo_inf_11.jpg', 'infoString1': '3450884'}, 'pricePerSquareFoot': 288, 'buyerAgent': None, 'event': 'Price change', 'price': 370000}, {'priceChangeRate': 2.620253164557, 'date': '2023-01-05', 'source': 'OneKey® MLS', 'postingIsRental': False, 'time': 1672876800000, 'sellerAgent': None, 'showCountyLink': False, 'attributeSource': {'infoString2': 'OneKey® MLS', 'infoString3': 'https://photos.zillowstatic.com/fp/4e66a55bd37a412d002fb678e0dbded9-zillow_web_logo_inf_11.jpg', 'infoString1': '3450884'}, 'pricePerSquareFoot': 334, 'buyerAgent': None, 'event': 'Listed for sale', 'price': 429000}, {'priceChangeRate': 0, 'date': '1999-04-15', 'source': 'Public Record', 'postingIsRental': False, 'time': 924134400000, 'sellerAgent': None, 'showCountyLink': False, 'attributeSource': {'infoString2': 'Public Record', 'infoString3': None, 'infoString1': None}, 'pricePerSquareFoot': 92, 'buyerAgent': None, 'event': 'Sold', 'price': 118500}], 'taxHistory': [{'time': 1660503932677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 346}, {'time': 1628967932677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 0.5504978, 'taxPaid': 6344.42, 'value': None}, {'time': 1597431932677, 'valueIncreaseRate': -0.09558824, 'taxIncreaseRate': -0.069594115, 'taxPaid': 4091.86, 'value': 369}, {'time': 1565809532677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 0, 'taxPaid': 4397.93, 'value': 408}, {'time': 1534273532677, 'valueIncreaseRate': -0.059907835, 'taxIncreaseRate': -0.01707516, 'taxPaid': 4397.93, 'value': 408}, {'time': 1502737532677, 'valueIncreaseRate': -0.14398421, 'taxIncreaseRate': -0.15941085, 'taxPaid': 4474.33, 'value': 434}, {'time': 1471201532677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 6.267285, 'taxPaid': 5322.85, 'value': 507}, {'time': 1439579132677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 0.058515772, 'taxPaid': 732.44, 'value': 507}, {'time': 1376507132677, 'valueIncreaseRate': -0.24101797, 'taxIncreaseRate': -0.1499072, 'taxPaid': 691.95, 'value': 507}, {'time': 1344971132677, 'valueIncreaseRate': -0.08867667, 'taxIncreaseRate': -0.8373053, 'taxPaid': 813.97, 'value': 668}, {'time': 1313348732677, 'valueIncreaseRate': -0.06979696, 'taxIncreaseRate': 0.097350165, 'taxPaid': 5003.05, 'value': 733}, {'time': 1281812732677, 'valueIncreaseRate': 0.008962868, 'taxIncreaseRate': 0, 'taxPaid': 4559.21, 'value': 788}, {'time': 1250276732677, 'valueIncreaseRate': 0.05970149, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 781}, {'time': 1218740732677, 'valueIncreaseRate': 0.058908045, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 737}, {'time': 1155582332677, 'valueIncreaseRate': -0.39740258, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 696}, {'time': 1124046332677, 'valueIncreaseRate': -0.3157583, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 1155}, {'time': 1092510332677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 1688}, {'time': 1060887932677, 'valueIncreaseRate': -0.5035294, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 1688}, {'time': 1029351932677, 'valueIncreaseRate': -0.12820514, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 3400}, {'time': 997815932677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 3900}, {'time': 966279932677, 'valueIncreaseRate': 0, 'taxIncreaseRate': 0, 'taxPaid': None, 'value': 3900}]}

 findAgent
 CRITICAL:root:findAgent response: {'agents': [{'profileLink': {'text': 'Richard Raspantini', 'href': '/profile/RichardRaspantini/'}, 'index': 0, 'reviewExcerpt': {'excerpt': 'He was very knowledgeable of the local market and local listings that would fit ...', 'href': '/profile/RichardRaspantini/#reviews', 'reviewLink': {'text': 'Review 12/22/2017', 'href': '/profile/RichardRaspantini/#reviews'}}, 'zuid': 'X1-ZUyatcuf0oaio9_6frtm', 'contact': {'graphic': {'image': {'alt': "Richard Raspantini's profile photo", 'src': 'https://photos.zillowstatic.com/h_g/IS1jjennngd07p0000000000.jpg'}, 'isCircle': True}, 'summary': {'profileLink': {'text': 'Richard Raspantini', 'href': '/profile/RichardRaspantini/'}, 'encZuid': 'X1-ZUyatcuf0oaio9_6frtm', 'reviewLink': {'text': '74 total reviews (1 local)', 'href': '/profile/RichardRaspantini/#reviews'}, 'isReviewable': True, 'reviewStars': {'rating': 5, 'href': '/profile/RichardRaspantini/#reviews', 'stars': '500'}, 'phone': '(270) 758-6318', 'featured': False, 'license': ''}}, 'href': '/profile/RichardRaspantini/', 'hasActivity': True, 'map': 
{'label': 'In 11566:', 'bingLogo': {'bgY': -28, 'height': 19, 'bgX': 0, 'width': 65, 'src': 'data:image/png;base64,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'}, 'image': {'alt': "Map of Richard Raspantini's listings", 'width': 400, 'src': 'https://maps.googleapis.com/maps/api/staticmap?center=40.646945,-73.551721&zoom=9&size=400x160&maptype=roadmap&key=AIzaSyCadFmqeT-wY9jYJ9TJi5x8J1GzggZ5oFQ&style=feature%3Aadministrative.land_parcel%7Celement%3Aall%7Cvisibility%3Aoff%7C&style=feature%3Aadministrative.locality%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Aadministrative.neighborhood%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Aadministrative.province%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Alandscape%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Alandscape.man_made%7Celement%3Ageometry%7Csaturation%3A-100%7C&style=feature%3Alandscape.man_made%7Celement%3Ageometry.stroke%7Ccolor%3A0xdcdcdc%7C&style=feature%3Alandscape.natural%7Celement%3Aall%7Ccolor%3A0xe6e6e6%7C&style=feature%3Alandscape.natural%7Celement%3Alabels.text.fill%7Ccolor%3A0x7f7f7f%7C&style=feature%3Alandscape.natural.landcover%7Celement%3Aall%7Ccolor%3A0xe6e6e6%7C&style=feature%3Alandscape.natural.terrain%7Celement%3Aall%7Ccolor%3A0xe6e6e6%7C&style=feature%3Apoi%7Celement%3Ageometry.fill%7Ccolor%3A0xd6d6d6%7C&style=feature%3Apoi%7Celement%3Alabels.text%7Cvisibility%3Aoff%7C&style=feature%3Apoi.attraction%7Celement%3Aall%7Cvisibility%3Aoff%7C&style=feature%3Apoi.business%7Celement%3Aall%7Cvisibility%3Aoff%7C&style=feature%3Apoi.government%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.medical%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.medical%7Celement%3Alabels.text%7Cvisibility%3Aon%7C&style=feature%3Apoi.park%7Celement%3Aall%7Ccolor%3A0xb0d896%7C&style=feature%3Apoi.park%7Celement%3Alabels%7Cvisibility%3Aon%7Cweight%3A2.5%7C&style=feature%3Apoi.park%7Celement%3Alabels.text.fill%7Ccolor%3A0x787878%7Cinvert_lightness%3Atrue%7C&style=feature%3Apoi.park%7Celement%3Alabels.text.stroke%7Ccolor%3A0xffffff%7C&style=feature%3Apoi.place_of_worship%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.school%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.sports_complex%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Aroad%7Celement%3Ageometry%7Ccolor%3A0xf8f8f8%7C&style=feature%3Aroad%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Atransit%7Celement%3Alabels.text%7Cvisibility%3Aoff%7C&style=feature%3Awater%7Celement%3Ageometry%7Ccolor%3A0xb1bdd7%7C&style=feature%3Awater%7Celement%3Alabels.text.fill%7Ccolor%3A0xffffff%7C&style=feature%3Awater%7Celement%3Alabels.text.stroke%7Ccolor%3A0xa0aecc%7C&signature=SKZbsfbLvap8h-yH9xMYR7oDNKE=', 'height': 160}, 'stats': {'listings': 'No Listings', 'recentSales': 'No Recent Sales', 'review': '1 Local Review'}, 'businessName': 'HomeSmart Premier Living Realty'}}, {'profileLink': {'text': 'Richard Walsh', 'href': '/profile/Richard-Walsh/'}, 'index': 1, 'reviewExcerpt': {'excerpt': 'He was the first agent (within minutes) to respond to my Trulia inquiries & had us...', 'href': '/profile/Richard-Walsh/#reviews', 'reviewLink': {'text': 'Review 11/19/2014', 'href': '/profile/Richard-Walsh/#reviews'}}, 'zuid': 'X1-ZUzv98bbin0tmx_1pt0h', 'contact': {'graphic': {'image': {'alt': "Richard Walsh's profile photo", 'src': 'https://photos.zillowstatic.com/h_g/IS1vkfq36r318e1000000000.jpg'}, 'isCircle': True}, 'summary': {'profileLink': {'text': 'Richard Walsh', 'href': '/profile/Richard-Walsh/'}, 'encZuid': 'X1-ZUzv98bbin0tmx_1pt0h', 'reviewLink': {'text': '4 total 
reviews (1 local)', 'href': '/profile/Richard-Walsh/#reviews'}, 'isReviewable': True, 'reviewStars': {'rating': 5, 'href': '/profile/Richard-Walsh/#reviews', 'stars': '500'}, 'phone': '(516) 323-9010', 'featured': False, 'license': ''}}, 'href': '/profile/Richard-Walsh/', 'hasActivity': True, 'map': {'label': 'In 11566:', 'bingLogo': {'bgY': -28, 'height': 19, 'bgX': 0, 'width': 65, 'src': 'data:image/png;base64,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'}, 'image': {'alt': "Map of Richard Walsh's listings", 'width': 400, 'src': 'https://maps.googleapis.com/maps/api/staticmap?center=40.646945,-73.551721&zoom=9&size=400x160&maptype=roadmap&key=AIzaSyCadFmqeT-wY9jYJ9TJi5x8J1GzggZ5oFQ&style=feature%3Aadministrative.land_parcel%7Celement%3Aall%7Cvisibility%3Aoff%7C&style=feature%3Aadministrative.locality%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Aadministrative.neighborhood%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Aadministrative.province%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Alandscape%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Alandscape.man_made%7Celement%3Ageometry%7Csaturation%3A-100%7C&style=feature%3Alandscape.man_made%7Celement%3Ageometry.stroke%7Ccolor%3A0xdcdcdc%7C&style=feature%3Alandscape.natural%7Celement%3Aall%7Ccolor%3A0xe6e6e6%7C&style=feature%3Alandscape.natural%7Celement%3Alabels.text.fill%7Ccolor%3A0x7f7f7f%7C&style=feature%3Alandscape.natural.landcover%7Celement%3Aall%7Ccolor%3A0xe6e6e6%7C&style=feature%3Alandscape.natural.terrain%7Celement%3Aall%7Ccolor%3A0xe6e6e6%7C&style=feature%3Apoi%7Celement%3Ageometry.fill%7Ccolor%3A0xd6d6d6%7C&style=feature%3Apoi%7Celement%3Alabels.text%7Cvisibility%3Aoff%7C&style=feature%3Apoi.attraction%7Celement%3Aall%7Cvisibility%3Aoff%7C&style=feature%3Apoi.business%7Celement%3Aall%7Cvisibility%3Aoff%7C&style=feature%3Apoi.government%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.medical%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.medical%7Celement%3Alabels.text%7Cvisibility%3Aon%7C&style=feature%3Apoi.park%7Celement%3Aall%7Ccolor%3A0xb0d896%7C&style=feature%3Apoi.park%7Celement%3Alabels%7Cvisibility%3Aon%7Cweight%3A2.5%7C&style=feature%3Apoi.park%7Celement%3Alabels.text.fill%7Ccolor%3A0x787878%7Cinvert_lightness%3Atrue%7C&style=feature%3Apoi.park%7Celement%3Alabels.text.stroke%7Ccolor%3A0xffffff%7C&style=feature%3Apoi.place_of_worship%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.school%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Apoi.sports_complex%7Celement%3Alabels.icon%7Cvisibility%3Aoff%7C&style=feature%3Aroad%7Celement%3Ageometry%7Ccolor%3A0xf8f8f8%7C&style=feature%3Aroad%7Celement%3Alabels.text.fill%7Ccolor%3A0x666666%7C&style=feature%3Atransit%7Celement%3Alabels.text%7Cvisibility%3Aoff%7C&style=feature%3Awater%7Celement%3Ageometry%7Ccolor%3A0xb1bdd7%7C&style=feature%3Awater%7Celement%3Alabels.text.fill%7Ccolor%3A0xffffff%7C&style=feature%3Awater%7Celement%3Alabels.text.stroke%7Ccolor%3A0xa0aecc%7C&signature=SKZbsfbLvap8h-yH9xMYR7oDNKE=', 'height': 160}, 'stats': {'listings': 'No Listings', 'recentSales': 'No Recent Sales', 'review': '1 Local Review'}, 'businessName': 'Keller Williams Greater Nassau Realty '}}, {'profileLink': {'text': 'Sandra Thackurdeen', 'href': '/profile/Sandra-Thackurdeen/'}, 
'index': 2, 'reviewExcerpt': {'excerpt': 'I worked with realtors before that I felt were so &quot;salesy,&quot; but I felt ...', 'href': '/profile/Sandra-Thackurdeen/#reviews', 'reviewLink': {'text': 'Review 04/14/2013', 'href': '/profile/Sandra-Thackurdeen/#reviews'}}, 'zuid': 'X1-ZUytrddp5pfuh5_1acra', 'contact': {'graphic': {'image': {'alt': "Sandra Thackurdeen's profile photo", 'src': 'https://photos.zillowstatic.com/h_g/IS-15a3laxa306sd.jpg'}, 'isCircle': True}, 'summary': {'profileLink': {'text': 'Sandra Thackurdeen', 'href': '/profile/Sandra-Thackurdeen/'}, 'encZuid': 'X1-ZUytrddp5pfuh5_1acra', 'reviewLink': {'text': '2 total reviews (1 local)', 'href': '/profile/Sandra-Thackurdeen/#reviews'}, 'isReviewable': True, 'reviewStars': {'rating': 5, 'href': '/profile/Sandra-Thackurdeen/#reviews', 'stars': '500'}, 'phone': '(516) 643-5179', 'featured': False, 'license': ''}}, 'href': '/profile/Sandra-Thackurdeen/', 'hasActivity': True, 'map': {'label': 'In 11566:', 'bingLogo': {'bgY': -28, 'height': 19, 'bgX': 0, 'width': 65, 'src':
 """

class TestListingsHandler(unittest.TestCase):
    @patch("handlers.ZillowAPIManager.call_zillow_api")
    def test_handle_listing_api(self, mock_call_zillow_api):
        # Define a mock response that matches the expected structure of the real API response
        mock_response = {"some_key": "some_value"}  # Adjust this to match the real response structure

        # Set up the mock object to return the mock response
        mock_call_zillow_api.return_value = mock_response

        # Create an instance of the ListingsHandler class with some excluded home types
        excluded_hometypes = ["some_type"]
        handler = ListingsHandler(excluded_hometypes)

        # Call the _handle_listing_api method
        zip_code = "12345"
        amount = 10
        result = handler._handle_listing_api(zip_code, amount)

        # Check that the result is what you expect
        expected_result = "expected result"  # Replace with the expected output
        self.assertEqual(result, expected_result)
